# Load the conditions from the Excel file  
trials_conditions = data.importConditions('conditions_stress.xlsx')

import pandas as pd
from random import sample

# Convert conditions list to DataFrame
trials_df = pd.DataFrame(trials_conditions)

# Extract sentence_id and condition from file names
trials_df['sentence_id'] = trials_df['sounds'].str.extract(r'(\d+)')[0]
trials_df['condition'] = trials_df['sounds'].str.extract(r'\d+([a-d])')[0]

# Create a list to hold the selected rows
selected_rows = []

# For each condition a-d, select 10 unique sentence_ids and 1 matching row per sentence
for cond in ['a', 'b', 'c', 'd']:
    subset = trials_df[trials_df['condition'] == cond]
    
    # Sample 10 unique sentence_ids
    sampled_ids = sample(subset['sentence_id'].unique().tolist(), 10)
    
    # For each ID, pick the corresponding row
    for sid in sampled_ids:
        row = subset[subset['sentence_id'] == sid].sample(1)
        selected_rows.append(row)

# Combine and shuffle the selected rows
trials_selected_df = pd.concat(selected_rows).sample(frac=1).reset_index(drop=True)

# Convert to list of dictionaries for PsychoPy
trials_selected_rows = trials_selected_df.to_dict(orient='records')
